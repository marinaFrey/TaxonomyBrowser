<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Tutorial</title>
        <p>Click to change values</p>
        <script type="text/javascript" src="d3/d3.v3.js"></script>
         
        <style type="text/css">
            .axis path,
            .axis line
            {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }
            .axis text
            {
                font-family: sans-serif;
                font-size: 11px;
            }
            div.bar 
            {
                display: inline-block;
                width: 20px;
                height: 75px;   /* We'll override this later */
                background-color: teal;
                margin-right: 2px;
            },
            
            
            
        </style>
        
    </head>
    <body>
        <script type="text/javascript">
       
            var dataset = [ 5,10,15,27,26,40,20,100,50,35,10,70,30,20,80,100,140,150,30,60];
            var h = 500;
            var w = 600;
            var barPadding = 7;
            var circlePadding = 40;
            var borderBarPadding = 7;
            /*
            var xScale = d3.scale.linear();
            xScale.domain([0,d3.max(dataset, function(d){return d;})]);
            xScale.range([borderBarPadding,w - borderBarPadding]);*/
            
            var xScale = d3.scale.ordinal();
            xScale.domain(d3.range(dataset.length));
            xScale.rangeRoundBands([0,w],0.05);
            
            var yScale = d3.scale.linear();
            yScale.domain([0,d3.max(dataset)]);
            yScale.range([0,h]);
        
            
            
            var svg = d3.select("body").append("svg");
            svg.attr("width", w);
            svg.attr("height",h);
            
            svg.selectAll("rect")
                .data(dataset)
                .enter()
                .append("rect")               
                .attr("x",function(d,i){return xScale(i);})
                .attr("y",function(d){return h - yScale(d);})
                .attr("width",xScale.rangeBand())
                .attr("height",function(d){return yScale(d);})
                .attr("fill", function(d){return "rgb("+ ( d * 8 ) +"," + (d ) + ","+ (d * 2) + ")";});;
            
            svg.selectAll("text")
                .data(dataset)
                .enter()
                .append("text")
                .text(function(d){return d;})
                .attr("text-anchor","middle")
                .attr("x",function(d,i){return xScale(i) + ((w) / dataset.length - barPadding) / 2;})
                .attr("y",function(d){return h - yScale(d)+14;})
                .attr("font-family", "Lucida Console")
			    .attr("font-size", "11px")
			    .attr("fill", "white");

            /*
            var yAxis = d3.svg.axis();
            yAxis.scale(yScale);
            yAxis.orient("left");
            svg.append("g")
                .attr("class","axis")
                .attr("transform", "translate(" + (circlePadding - 10) +",0)")
                .call(yAxis);*/
            
            
             
               
/********************* EXEMPLO 2 ************************************************************************************************************************/
            var svg2 = d3.select("body").append("svg");
            svg2.attr("width", w);
            svg2.attr("height",h); 
            
            //Dynamic, random dataset
            var dataset2 = [];
            var numDataPoints = 20;
            var xRange = Math.random() * 1000;
            var yRange = Math.random() * 1000;
            for (var i = 0; i < numDataPoints; i++) {
                var newNumber1 = Math.round(Math.random() * xRange);
                var newNumber2 = Math.round(Math.random() * yRange);
                dataset2.push([newNumber1, newNumber2]);
            }
            /*
            var dataset2 = 
            [
                [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
                [410, 12], [475, 44], [25, 67], [85, 21], [220, 88], [600,150]
            ];*/
            
            var xxScale = d3.scale.linear();
            xxScale.domain([0,d3.max(dataset2, function(d){return d[0];})]);
            xxScale.range([circlePadding,w - circlePadding]);
            
            var yyScale = d3.scale.linear();
            yyScale.domain([0,d3.max(dataset2, function(d){return d[1];})]);
            yyScale.range([h - circlePadding,circlePadding]);
            
            var rScale = d3.scale.linear();
            rScale.domain([0,d3.max(dataset2, function(d){return d[1];})]);
            rScale.range([2,5]);
            
            var xxAxis = d3.svg.axis();
            xxAxis.scale(xxScale);
            xxAxis.orient("bottom")
            .ticks(5);
            
            var yyAxis = d3.svg.axis();
            yyAxis.scale(yyScale);
            yyAxis.orient("left")
            .ticks(5);
            
            svg2.append("clipPath")
                .attr("id","chart-area")
                .append("rect")
                .attr("x",borderBarPadding)
                .attr("y",borderBarPadding)
                .attr("width", w - borderBarPadding*3)
                .attr("height", h - borderBarPadding*2);
            
            svg2.append("g")
                .attr("id","circles")
                .attr("clip-path", "url(#chart-area)")
                .selectAll("circle")
                .data(dataset2)
                .enter()
                .append("circle")
                .attr("cx", function(d){return xxScale(d[0]);})
                .attr("cy", function(d){return yyScale(d[1]);})
                .attr("r", function(d){return rScale(d[1]);})
                .attr("fill", function(d){return "rgb("+ ( d[1]*2 ) +"," + (100 ) + ","+ (d[0]*2) + ")";});;
                
                /*
            svg2.selectAll("text")
                .data(dataset2)
                .enter()
                .append("text")
                .text(function(d){return d[0] + "," + d[1];})
                .attr("x",function(d){return xxScale(d[0]);})
                .attr("y",function(d){return yyScale(d[1]);})
                .attr("font-family", "sans-serif")
                .attr("font-size", "11px")
                .attr("fill", "red");*/
            
            
            svg2.append("g")
                .attr("class","x axis")
                .attr("transform", "translate(0," + ( h - circlePadding) + ")")
                .call(xxAxis);
                
            svg2.append("g")
                .attr("class","y axis")
                .attr("transform", "translate(" + (circlePadding - 10) +",0)")
                .call(yyAxis);
                
            
            
 /***************** EVENTOS *******************************************************************************************************************/ 

            d3.select("p")
                .on("click", function() 
                {
                    
                    var num = dataset.length;
                    dataset = [];
                    var range = Math.random() * 100;
                    for (var i = 0; i < numDataPoints; i++) 
                    {
                        var newNumber = Math.round(Math.random() * range);
                        dataset.push(newNumber);
                    }

                    yScale.domain([0,d3.max(dataset)]);
                    yScale.range([0,h]);
                    
                    svg.selectAll("rect")
                       .data(dataset)
                       .transition()
                       .delay(function(d,i){return (i/dataset.length)*100;}) 
                       .duration(1000)
                       .ease("elastic")
                       .attr("y", function(d) {return h - yScale(d);})
                       .attr("height", function(d) {return yScale(d);})
                       .attr("fill", function(d){return "rgb("+ ( d * 8 ) +"," + (d ) + ","+ (d * 2) + ")";});
                       
                    svg.selectAll("text")
                       .data(dataset)
                       .transition()
                       .delay(function(d,i){return (i/dataset.length)*100;}) 
                       .duration(1000)
                       .ease("elastic")
                       .text(function(d) {return d;})
                       .attr("x", function(d, i) {return xScale(i) + xScale.rangeBand() / 2;})
                       .attr("y", function(d) {return h - yScale(d) + 14;});
                       
                       
                    /**************** EXEMPLO 2 *******************************************************************************************/
                    
                    var num = dataset2.length;
                    dataset2 = [];
                    var xRange = Math.random() * 1000;
                    var yRange = Math.random() * 1000;
                    for (var i = 0; i < numDataPoints; i++) {
                        var newNumber1 = Math.round(Math.random() * xRange);
                        var newNumber2 = Math.round(Math.random() * yRange);
                        dataset2.push([newNumber1, newNumber2]);
                    }
                    
                    xxScale.domain([0,d3.max(dataset2, function(d){return d[0];})]);
                    yyScale.domain([0,d3.max(dataset2, function(d){return d[1];})]);

                    svg2.selectAll("circle")
                        .data(dataset2)
                        .transition()
                        .duration(1000)
                        //.ease("elastic")
                        .attr("cx", function(d){return xxScale(d[0]);})
                        .attr("cy", function(d){return yyScale(d[1]);})
                        .attr("r", function(d){return rScale(d[1]);})
                        .attr("fill", function(d){return "rgb("+ ( d[1]*2 ) +"," + (100 ) + ","+ (d[0]*2) + ")";})
                        
                    
                    //Update x-axis
                    svg2.select(".x.axis")
                        .transition()
                        .duration(1000)
                        .call(xxAxis);

                    //Update y-axis
                    svg2.select(".y.axis")
                        .transition()
                        .duration(1000)
                        .call(yyAxis);
                   
                }); 
                
        </script>
    </body>
</html>    